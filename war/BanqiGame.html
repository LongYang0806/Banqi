<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Banqi game</title>
  <style type="text/css" media="only screen and (max-device-width: 480px)">
    body > div {
      -webkit-transition: all 1s ease-in-out;
    }
  </style>
  <script type="text/javascript" language="javascript"
          src="banqi_game/banqi_game.nocache.js"></script>
  <script
      src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
</head>
<body>
<div id="mainDiv" style="height: 800px; width: 400px;"></div>
<script>
  var scaleBody = function (myGameWidth, myGameHeight) {
    console.log("Start scaling...");
    console.log("Width: " + window.innerWidth);
    console.log("Height: " + window.innerHeight);
    console.log("Game width: " + $("#mainDiv").width());
    console.log("Game height: " + $("#mainDiv").height());
    var scaleX = window.innerWidth / myGameWidth;
    var scaleY = window.innerHeight / myGameHeight;
    var scale = Math.min(scaleX, scaleY);
    var transformString = "scale(" + scale + "," + scale + ")";
    document.body.style.transform = transformString;
    document.body.style['-o-transform'] = transformString;
    document.body.style['-webkit-transform'] = transformString;
    document.body.style['-moz-transform'] = transformString;
    document.body.style['-ms-transform'] = transformString;
    var transformOriginString = "0 0 0";
    document.body.style['transform-origin'] = transformOriginString;
    document.body.style['-o-transform-origin'] = transformOriginString;
    document.body.style['-webkit-transform-origin'] = transformOriginString;
    document.body.style['-moz-transform-origin'] = transformOriginString;
    document.body.style['-ms-transform-origin'] = transformOriginString;
    console.log("Game width: " + $("#mainDiv").width());
    console.log("Game height: " + $("#mainDiv").height());
    console.log("Scaled...");
  };

  $(document).ready(function () {
    function reorient(e) {
      var mainDivWidth = $("#mainDiv").width();
      var mainDivHeight = $("#mainDiv").height();
      console.log("Game width: " + mainDivWidth);
      console.log("Game height: " + mainDivHeight);
      if (window.innerWidth < 800 || window.innerHeight < 400) {
        console.log("Start rotating...");
        var portrait = (window.orientation === 90 || window.orientation === 270);
        $("#mainDiv").css("-webkit-transform",
            !portrait ? "rotate(90deg)" : "");
        if (!portrait) {
          console.log("Woking...");
          var width = $("#mainDiv").width();
          var height = $("#mainDiv").height();
          var marginLeft = (width - height) / 2;
          var marginTop = (width - height) / 2;
          $("#mainDiv").css("margin-left",
                  marginLeft + "px");
          $("#mainDiv").css("margin-top",
                  marginTop + "px");
          scaleBody(400, 800);
        } else {
          console.log("Woking...");
          var width = $("#mainDiv").width();
          var height = $("#mainDiv").height();
          var marginLeft = 0;
          var marginTop = 0;
          $("#mainDiv").css("margin-left",
                  marginLeft + "px");
          $("#mainDiv").css("margin-top",
                  marginTop + "px");
          scaleBody(800, 400);
        }
        console.log("Rotated...");
      } else {
        scaleBody(800, 400);
      }
    }

//    window.onresize = reorient;
    window.onorientationchange = reorient;
    window.setTimeout(reorient, 0);

//    window.onresize = scaleBody;
//    //window.onorientationchange = scaleBody;
//    document.addEventListener("orientationchange", reorient);
//    scaleBody();
  });
</script>
</body>
</html>